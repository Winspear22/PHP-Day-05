{% extends 'base.html.twig' %}

{% block title %}Ex13 - Gestion des employés{% endblock %}

{% block body %}
<h1>Ex13 - Gestion des employés</h1>

{% for msg in app.flashes('success') %}
    <div class="alert alert-success">{{ msg }}</div>
{% endfor %}
{% for msg in app.flashes('error') %}
    <div class="alert alert-danger">{{ msg }}</div>
{% endfor %}

    {{ form_start(form) }}

    {% for child in form %}
        <div class="form-group">
            {{ form_label(child) }}
            {{ form_widget(child) }}
        </div>
    {% endfor %}

    <button type="submit">Enregistrer</button>
    {{ form_end(form) }}


<hr>

{# 3) Tableau des employés #}
<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Prénom</th>
            <th>Nom</th>
            <th>Email</th>
            <th>Actif</th>
            <th>Date de naissance</th>
            <th>Embauché depuis</th>
            <th>Embauché jusqu'à</th>
            <th>Heures</th>
            <th>Salaire</th>
            <th>Poste</th>
            <th>Manager</th>
            <th>Modifier</th>
            <th>Supprimer</th>
        </tr>
    </thead>
    <tbody>
        {% for employee in employees %}
            <tr>
                <td>{{ employee.id }}</td>
                <td>{{ employee.firstname }}</td>
                <td>{{ employee.lastname }}</td>
                <td>{{ employee.email }}</td>
                <td>{{ employee.active ? 'Oui' : 'Non' }}</td>
                <td>{{ employee.birthdate ? employee.birthdate|date('Y-m-d') : '' }}</td>
                <td>{{ employee.employedSince ? employee.employedSince|date('Y-m-d') : '' }}</td>
                <td>{{ employee.employedUntil ? employee.employedUntil|date('Y-m-d') : '' }}</td>
                <td>{{ employee.hours ? employee.hours.value : '' }}</td>
                <td>{{ employee.salary }}</td>
                <td>{{ employee.position ? employee.position.value : '' }}</td>
                <td>
                    {% if employee.manager %}
                        {{ employee.manager.firstname }} {{ employee.manager.lastname }}
                    {% else %}
                        Aucun
                    {% endif %}
                </td>
                <td>
                    <form method="get" action="{{ path('ex13_update', {'id': employee.id}) }}" style="display:inline;">
                        <button type="submit">Modifier</button>
                    </form>
                </td>
                <td>
                    <form method="post" action="{{ path('ex13_delete', {'id': employee.id}) }}" style="display:inline;">
                        <button type="submit" onclick="return confirm('Supprimer l\'employé #{{ employee.id }} ?')">Supprimer</button>
                    </form>
                </td>
            </tr>
        {% else %}
            <tr><td colspan="14">Aucun employé.</td></tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
