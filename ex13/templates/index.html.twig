{% extends 'base.html.twig' %}

{% block title %}Ex13 — Gestion des employés (ORM){% endblock %}

{% block body %}
	<h1>Ex13 — Gestion des employés (ORM)</h1>
	
	{% for msg in app.flashes('success') %}
        <div class="alert">{{ msg }}</div>
    {% endfor %}
    {% for msg in app.flashes('error') %}
        <div class="alert error">{{ msg }}</div>
    {% endfor %}

	<div style="margin-bottom:1em;">
		<a href="{{ path('ex13_create') }}"><button>Ajouter un employé</button></a>
	</div>

	<h2>Employés dans la table :</h2>
	<table>
		<tr>
			<th>ID</th>
			<th>Prénom</th>
			<th>Nom</th>
			<th>Email</th>
			<th>Date de naissance</th>
			<th>Actif</th>
			<th>Embauché depuis</th>
			<th>Jusqu'à</th>
			<th>Heures</th>
			<th>Salaire</th>
			<th>Poste</th>
			<th>Manager</th>
			<th>Actions</th>
		</tr>
		{% for employee in employees %}
			<tr>
				<td>{{ employee.id }}</td>
				<td>{{ employee.firstname }}</td>
				<td>{{ employee.lastname }}</td>
				<td>{{ employee.email }}</td>
				<td>{{ employee.birthdate ? employee.birthdate|date('Y-m-d') : '-' }}</td>
				<td>{{ employee.active ? 'Oui' : 'Non' }}</td>
				<td>{{ employee.employedSince ? employee.employedSince|date('Y-m-d') : '-' }}</td>
				<td>{{ employee.employedUntil ? employee.employedUntil|date('Y-m-d') : '-' }}</td>
				<td>{{ employee.hours ? employee.hours.value : '-' }}</td>
				<td>{{ employee.salary ?? '---' }}</td>
				<td>{{ employee.position ? employee.position.value : '-' }}</td>
				<td>{{ employee.manager ? employee.manager.firstname ~ ' ' ~ employee.manager.lastname : '-' }}
				</td>
				<td>
					<form action="{{ path('ex13_update', {'id': employee.id}) }}" method="post" style="display:inline;">
						<button type="submit">Modifier</button>
					</form>
					<form action="{{ path('ex13_delete', {'id': employee.id}) }}" method="post" style="display:inline;" onsubmit="return confirm('Confirmer la suppression ?');">
						<button type="submit">Supprimer</button>
					</form>
				</td>
			</tr>
		{% else %}
			<tr><td colspan="13" style="text-align:center;">Aucun employé enregistré.</td></tr>
		{% endfor %}
	</table>
{% endblock %}
