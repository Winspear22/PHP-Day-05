{% extends 'base.html.twig' %}

{% block title %}ex11 – Table Management{% endblock %}

{% block body %}
    <h1>ex11 – Table Management</h1>
    {# Flash messages #}
    {% for label, messages in app.flashes %}
        {% for message in messages %}
            <div class="alert alert-{{ label }}" style="margin-bottom: 0.5em;">{{ message }}</div>
        {% endfor %}
    {% endfor %}

    <form action="{{ path('ex11_create_all_tables') }}" method="post" style="margin-bottom: 1em;">
        <button type="submit">Create all tables (persons, bank_accounts, addresses)</button>
    </form>

    <form action="{{ path('ex11_fill_all_tables') }}" method="post" style="margin-bottom: 1em;">
        <button type="submit">Fill tables with random data</button>
    </form>

    <form method="get" action="{{ path('ex11_index') }}" style="margin-bottom: 1em;">
        <input type="text" name="filter_name" value="{{ filter_name }}" placeholder="Filter by name">
        <select name="sort_by">
            <option value="name" {% if sort_by == 'name' %}selected{% endif %}>Name</option>
            <option value="email" {% if sort_by == 'email' %}selected{% endif %}>Email</option>
            <option value="birthdate" {% if sort_by == 'birthdate' %}selected{% endif %}>Birthdate</option>
        </select>
        <select name="sort_dir">
            <option value="asc" {% if sort_dir == 'asc' %}selected{% endif %}>Asc</option>
            <option value="desc" {% if sort_dir == 'desc' %}selected{% endif %}>Desc</option>
        </select>
        <button type="submit">Apply</button>
    </form>

    <h2>Persons + Addresses + Bank Accounts</h2>
    <table border="1" style="width: 100%; margin-bottom: 2em;">
        <tr>
            <th>Id</th>
            <th>Username</th>
            <th>Name</th>
            <th>Email</th>
            <th>Enable</th>
            <th>Birthdate</th>
            <th>Marital Status</th>
            <th>Address</th>
            <th>IBAN</th>
            <th>Bank Name</th>
        </tr>
        {% for p in data %}
            <tr>
                <td>{{ p.id }}</td>
                <td>{{ p.username }}</td>
                <td>{{ p.name }}</td>
                <td>{{ p.email }}</td>
                <td>{{ p.enable }}</td>
                <td>{{ p.birthdate }}</td>
                <td>{{ p.marital_status }}</td>
                <td>{{ p.addresses|raw }}</td>
                <td>{{ p.iban }}</td>
                <td>{{ p.bank_name }}</td>
            </tr>
        {% else %}
            <tr><td colspan="10"><em>No data found</em></td></tr>
        {% endfor %}
    </table>
{% endblock %}
