{% extends 'base.html.twig' %}

{% block title %}Ex10 — SQL & ORM Demo{% endblock %}

{% block body %}
<h1>ex10 — SQL & ORM (File, Manual, Import)</h1>

{# Messages flash #}
{% for label, messages in app.flashes %}
    {% for message in messages %}
        <div class="alert alert-{{ label }} mb-2">{{ message|raw }}</div>
    {% endfor %}
{% endfor %}

<div class="row">
    <div class="col-md-6">
        <h2>SQL Table</h2>
        <a href="{{ path('ex10_insert_sql') }}" class="btn btn-success btn-sm mb-2">Add SQL Record</a>
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Data</th>
                    <th>Date</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody>
                {% for record in sqlRecords %}
                    <tr>
                        <td>{{ record.id }}</td>
                        <td>{{ record.data }}</td>
                        <td>{{ record.date ? record.date|date('Y-m-d H:i:s') : '' }}</td>
                        <td>
                            <form action="{{ path('ex10_delete_sql', {id: record.id}) }}" method="post" style="display:inline" onsubmit="return confirm('Delete this SQL row?');">
                                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                            </form>
                        </td>
                    </tr>
                {% else %}
                    <tr><td colspan="4" class="text-center text-muted">No data</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="col-md-6">
        <h2>ORM Table</h2>
        <a href="{{ path('ex10_insert_orm') }}" class="btn btn-primary btn-sm mb-2">Add ORM Record</a>
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Data</th>
                    <th>Date</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody>
                {% for record in ormRecords %}
                    <tr>
                        <td>{{ record.id }}</td>
                        <td>{{ record.data }}</td>
                        <td>{{ record.date ? record.date|date('Y-m-d H:i:s') : '' }}</td>
                        <td>
                            <form action="{{ path('ex10_delete_orm', {id: record.id}) }}" method="post" style="display:inline" onsubmit="return confirm('Delete this ORM row?');">
                                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                            </form>
                        </td>
                    </tr>
                {% else %}
                    <tr><td colspan="4" class="text-center text-muted">No data</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<hr>

<div class="mt-3">
    <h3>Import from File (data.txt)</h3>
    <form action="{{ path('ex10_import') }}" method="post" style="display:inline">
        <button type="submit" class="btn btn-warning">
            Import data.txt → SQL & ORM tables
        </button>
    </form>
    <small class="text-muted ms-2">Each line will be inserted into both tables.</small>
</div>

{% endblock %}
