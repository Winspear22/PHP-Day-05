{% extends 'base.html.twig' %}

{% block title %}Ex06 — Modifier une personne{% endblock %}

{% block body %}
    <h1>Gestion des personnes</h1>

    {# Affiche les messages flash (succès/erreur) #}
    {% for msg in app.flashes('notice') %}
        <div class="alert">{{ msg }}</div>
    {% endfor %}

    {# Si on édite une personne, afficher le formulaire pré-rempli #}
    {% if editPerson %}
        <h2>Modifier la personne #{{ editPerson.id }}</h2>
        <form method="post" action="?edit={{ editPerson.id }}">
            <label>Username
                <input type="text" name="username" value="{{ editPerson.username }}" required>
            </label>
            <label>Name
                <input type="text" name="name" value="{{ editPerson.name }}" required>
            </label>
            <label>Email
                <input type="email" name="email" value="{{ editPerson.email }}" required>
            </label>
            <label>
                <input type="checkbox" name="enable" value="1" {% if editPerson.enable %}checked{% endif %}>
                Enable
            </label>
            <label>Birthdate
                <input type="date" name="birthdate" value="{{ editPerson.birthdate|date('Y-m-d') }}" required>
            </label>
            <label>Address
                <textarea name="address" required>{{ editPerson.address }}</textarea>
            </label>
            <button type="submit">Enregistrer les modifications</button>
            <a href="{{ path('ex06_index') }}"><button type="button">Annuler</button></a>
        </form>
        <hr>
    {% endif %}

    <h2>Liste des personnes</h2>
    <table>
        <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Name</th>
            <th>Email</th>
            <th>Enable</th>
            <th>Birthdate</th>
            <th>Address</th>
            <th>Action</th>
        </tr>
        {% for person in persons %}
            <tr>
                <td>{{ person.id }}</td>
                <td>{{ person.username }}</td>
                <td>{{ person.name }}</td>
                <td>{{ person.email }}</td>
                <td>{{ person.enable ? 'Oui' : 'Non' }}</td>
                <td>{{ person.birthdate|date('Y-m-d') }}</td>
                <td>{{ person.address }}</td>
                <td>
                    <a href="?edit={{ person.id }}"><button>Modifier</button></a>
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="8" style="text-align: center;">Aucune personne enregistrée.</td>
            </tr>
        {% endfor %}
    </table>
{% endblock %}
